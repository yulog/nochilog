<b:if cond='data:view.isPost'>
<div class='related-posts-container' id='related-posts-widget'/>
<div style='clear: both;'/>
<script type='text/javascript'>
let labelArray = <b:eval expr='data:post.labels map (label =&gt; label.name)'/>;
let relatedSettings = {
blogURL:&quot;<data:blog.homepageUrl/>&quot;,
relatedHeading:&quot;&lt;h4&gt;&lt;span&gt;関連する投稿&lt;/span&gt;&lt;/h4&gt;&quot;,
relatedNotfound:&quot;&lt;li&gt;関連記事はありません&lt;/li&gt;&quot;,
relatedPosts:4,
relatedStyle:3,
thumbnailSize:&quot;w300-h200-p-k-no-nu&quot;,
thumbnailSize2x:&quot;w600-h400-p-k-no-nu&quot;,
defaultThumb:&quot;https://yulog.github.io/nochilog/image/no_thumb.svg&quot;,
roundThumbs:false,
titleLength:&quot;auto&quot;,
snippetLength:45,
centerText:false,
openNewTab:false,
currentURL:&quot;<data:post.url.canonical.https/>&quot;
};</script>
<script type='text/javascript'>
//<![CDATA[
let randomRelatedIndex,startRelated;!((a,e,b)=>{let l={callBack:()=>{}};for(let c in relatedSettings)l[c]="undefined"==relatedSettings[c]?l[c]:relatedSettings[c];const d=c=>{let a=e.createElement("script");a.type="text/javascript",a.src=c,b.appendChild(a)},f=(a,b)=>Math.floor(Math.random()*(b-a+1))+a,r=([...c])=>{let a=c.length;if(0===a)return!1;for(let b=a-1;0<=b;b--){const a=Math.floor(Math.random()*(b+1));[c[b],c[a]]=[c[a],c[b]]}return c},g="object"==typeof labelArray&&0<labelArray.length?`/-/${r(labelArray)[0]}`:"",c=d=>{let a,f,h,k,s,t,u,v=document.getElementById("related-posts-widget"),b=r(d.feed.entry),c=l.relatedStyle,e=`${l.relatedHeading}<ul class="related-posts-${c}">`,w=l.openNewTab?" target=\"_blank\"":"",g=l.centerText?"text-align:center;":"",i=l.roundThumbs?"-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;":"",j=l.currentURL;if(v){for(let d=0;d<l.relatedPosts&&d!=b.length;d++){f=b[d].title.$t,h="auto"!==l.titleLength&&l.titleLength<f.length?`${f.substring(0,l.titleLength)}&hellip;`:f,k="media$thumbnail"in b[d]&&!1!==l.thumbnailSize?b[d].media$thumbnail.url.replace(/\/s[0-9]+(\-c)?/,`/${l.thumbnailSize}`):l.defaultThumb,t="media$thumbnail"in b[d]&&!1!==l.thumbnailSize?`<source srcset="${b[d].media$thumbnail.url.replace(/\/s[0-9]+(\-c)?/,`/${l.thumbnailSize}-rw`)}, ${b[d].media$thumbnail.url.replace(/\/s[0-9]+(\-c)?/,`/${l.thumbnailSize2x}-rw`)} 2x">`:"",u="media$thumbnail"in b[d]&&!1!==l.thumbnailSize2x?` srcset="${b[d].media$thumbnail.url.replace(/\/s[0-9]+(\-c)?/,`/${l.thumbnailSize2x}`)} 2x"`:"";let m=new Intl.DateTimeFormat("en-US",{dateStyle:"long"}).format(new Date(b[d].published.$t));s="summary"in b[d]&&0<l.snippetLength?`${b[d].summary.$t.replace(/<br ?\/?>/g," ").replace(/<.*?>/g,"").replace(/[<>]/g,"").substring(0,l.snippetLength)}&hellip;`:"",a=b[d].link.some(a=>"alternate"==a.rel)?b[d].link.find(a=>"alternate"==a.rel).href:"#";let n=new URL(a);a=`https://${n.host}${n.pathname}`,j==a?1==b.length&&(e+=l.relatedNotfound):1==c?e+=`<li><a href="${a}" ${w}>${h}</a></li>`:2==c?e+=`<li><a href="${a}" ${w}><div class="related-title">${h}</div></a><div class="related-snippets">${s}</div></li>`:3==c?e+=`<li class="related-post-item" style="${g}"><a href="${a}" ${w}><picture>${t}<img alt="" class="related-thumb-large" src="${k}"${u} style="${i}"></picture><div class="related-title">${h}</div><div class="related-snippets">${s}</div></a></li>`:4==c?e+=`<li class="related-post-item" style="${g}"><a href="${a}" ${w}><img alt="" class="related-thumb-large" src="${k}" style="${i}"><div class="related-title">${h}</div></a><div class="related-date">${m}</div></li>`:5==c?e+=`<li class="related-post-item" style="${g}"><a href="${a}" ${w}><img alt="" class="related-thumb-large" src="${k}" style="${i}"><div class="related-title">${h}</div></a></li>`:6==c?e+=`<li class="related-post-item"><a href="${a}" ${w}><img alt="" class="related-thumb-large" src="${k}" style="${i}"><div class="related-wrapper" style="${i}"><div class="related-wrapper-inner"><div class="related-title">${h}</div></div></div></a></li>`:7==c?e+=`<li class="related-post-item"><a href="${a}" ${w}><img alt="" class="related-thumb-large" src="${k}" style="${i}"></a></li>`:8==c?e+=`<li class="related-post-item"><a class="related-post-item-wrapper" href="${a}" ${w}><img alt="" class="related-thumb" src="${k}" style="${i}"><div class="related-title">${h}</div></a><div class="related-date">${m}</div></li>`:9==c&&(e+=`<li><a href="${a}" ${w}><img alt="" class="related-thumb" src="${k}" style="${i}"><div class="related-title">${h}</div></a><div class="related-snippets">${s}</div></li>`)}v.innerHTML=e+=`</ul>${"<span style=\"display:block;clear:both;\"></span>"}`,l.callBack()}};randomRelatedIndex=e=>{let a=e.feed.openSearch$totalResults.$t-l.relatedPosts,b=f(1,0<a?a:1);d(`${l.blogURL.replace(/\/$/,"")}/feeds/posts/summary${g}?alt=json-in-script&orderby=updated&start-index=${b}&max-results=${l.relatedPosts}&callback=startRelated`)},startRelated=c,d(`${l.blogURL.replace(/\/$/,"")}/feeds/posts/summary${g}?alt=json-in-script&orderby=updated&max-results=0&callback=randomRelatedIndex`)})(window,document,document.getElementsByTagName("head")[0]);
//]]>
</script>
</b:if>